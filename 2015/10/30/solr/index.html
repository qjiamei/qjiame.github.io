<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Solr | JAVA前沿</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Solr</h1><a id="logo" href="/.">JAVA前沿</a><p class="description">阙继芳的技术博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Solr</h1><div class="post-meta">Oct 30, 2015<span> | </span><span class="category"><a href="/categories/框架/">框架</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-什么是Solr"><span class="toc-number">1.</span> <span class="toc-text">一. 什么是Solr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-Solr安装"><span class="toc-number">2.</span> <span class="toc-text">二. Solr安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三-中文分析器IK-Analyzer"><span class="toc-number">3.</span> <span class="toc-text">三. 中文分析器IK Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四-IK-Analyzer配置"><span class="toc-number">4.</span> <span class="toc-text">四. IK Analyzer配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五-配置域"><span class="toc-number">5.</span> <span class="toc-text">五. 配置域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六-复制域"><span class="toc-number">6.</span> <span class="toc-text">六. 复制域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#七-动态域"><span class="toc-number">7.</span> <span class="toc-text">七. 动态域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#八-Spring-Data-Solr简介"><span class="toc-number">8.</span> <span class="toc-text">八. Spring Data Solr简介</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-在src-main-resources下创建-applicationContext-solr-xml"><span class="toc-number">8.0.1.</span> <span class="toc-text">2. 在src/main/resources下创建  applicationContext-solr.xml</span></a></li></ol></li></ol><li class="toc-item toc-level-3"><a class="toc-link" href="#八-Field-注解"><span class="toc-number">9.</span> <span class="toc-text">八. @Field 注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#九-增加（修改）"><span class="toc-number">10.</span> <span class="toc-text">九. 增加（修改）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十-按主键查询"><span class="toc-number">11.</span> <span class="toc-text">十. 按主键查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十一-按主键删除"><span class="toc-number">12.</span> <span class="toc-text">十一. 按主键删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十二-分页查询"><span class="toc-number">13.</span> <span class="toc-text">十二. 分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十三-条件查询"><span class="toc-number">14.</span> <span class="toc-text">十三. 条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十四-删除全部数据"><span class="toc-number">15.</span> <span class="toc-text">十四. 删除全部数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十五-项目中运用"><span class="toc-number">16.</span> <span class="toc-text">十五.项目中运用</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-两种导入方法-第一种使用dataimpor-第二种使用工具类进行导入"><span class="toc-number">16.0.0.1.</span> <span class="toc-text">1. 两种导入方法,第一种使用dataimpor,第二种使用工具类进行导入</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-数据导入Solr索引库"><span class="toc-number">16.0.0.2.</span> <span class="toc-text">2. 数据导入Solr索引库</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-添加Solr配置文件"><span class="toc-number">16.0.1.</span> <span class="toc-text">3. 添加Solr配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-调用模板类导入solr"><span class="toc-number">16.0.2.</span> <span class="toc-text">4. 调用模板类导入solr</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-规格导入动态域"><span class="toc-number">16.0.3.</span> <span class="toc-text">5. 规格导入动态域</span></a></li></div></div><div class="post-content"><h3 id="一-什么是Solr"><a href="#一-什么是Solr" class="headerlink" title="一. 什么是Solr"></a>一. 什么是Solr</h3><ol>
<li>Solr是一个开源搜索平台，用于构建搜索应用程序。 它建立在Lucene(全文搜索引擎)之上。 Solr是企业级的，快速的和高度可扩展的。 使用Solr构建的应用程序非常复杂，可提供高性能。</li>
<li>Solr可以和Hadoop一起使用。由于Hadoop处理大量数据，Solr帮助我们从这么大的源中找到所需的信息。不仅限于搜索，Solr也可以用于存储目的。像其他NoSQL数据库一样，它是一种非关系数据存储和处理技术。总之，Solr是一个可扩展的，可部署，搜索/存储引擎，优化搜索大量以文本为中心的数据。<a id="more"></a>
<h3 id="二-Solr安装"><a href="#二-Solr安装" class="headerlink" title="二. Solr安装"></a>二. Solr安装</h3></li>
<li>安装 Tomcat，解压缩即可。</li>
<li>解压 solr。</li>
<li>把 solr 下的dist目录solr-4.10.3.war部署到 Tomcat\webapps下(去掉版本号)。</li>
<li>启动 Tomcat解压缩 war 包</li>
<li>把solr下example/lib/ext 目录下的所有的 jar 包，添加到 solr 的工程中(\WEB-INF\lib目录下)。</li>
<li>创建一个 solrhome 。solr 下的/example/solr 目录就是一个 solrhome。复制此目录到D盘改名为solrhome  </li>
<li>关联 solr 及 solrhome。需要修改 solr 工程的 web.xml 文件。<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;env-entry&gt;</span><br><span class="line">   &lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;</span><br><span class="line">   &lt;env-entry-value&gt;d:\solrhome&lt;/env-entry-value&gt;</span><br><span class="line">   &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;</span><br><span class="line">&lt;/env-entry&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>启动 Tomcat<br><a href="http://IP:8080/solr/" target="_blank" rel="noopener">http://IP:8080/solr/</a><br><img src="http://p6hod2vhp.bkt.clouddn.com/201810302130_469.png" alt=""></p>
<h3 id="三-中文分析器IK-Analyzer"><a href="#三-中文分析器IK-Analyzer" class="headerlink" title="三. 中文分析器IK Analyzer"></a>三. 中文分析器IK Analyzer</h3><ul>
<li>IK Analyzer 是一个开源的，基亍 java 语言开发的轻量级的中文分词工具包。从 2006年 12 月推出 1.0 版开始， IKAnalyzer 已经推出了 4 个大版本。最初，它是以开源项目Luence 为应用主体的，结合词典分词和文法分析算法的中文分词组件。从 3.0 版本开始，IK 发展为面向 Java 的公用分词组件，独立亍 Lucene 项目，同时提供了对 Lucene 的默认优化实现。在 2012 版本中，IK 实现了简单的分词歧义排除算法，标志着 IK 分词器从单纯的词典分词向模拟语义分词衍化。</li>
</ul>
<h3 id="四-IK-Analyzer配置"><a href="#四-IK-Analyzer配置" class="headerlink" title="四. IK Analyzer配置"></a>四. IK Analyzer配置</h3><ol>
<li>把IKAnalyzer2012FF_u1.jar 添加到 solr 工程的 lib 目录下</li>
<li>创建WEB-INF/classes文件夹  把扩展词典、停用词词典、配置文件放到 solr 工程的 WEB-INF/classes 目录下。</li>
<li>修改 Solrhome 的 schema.xml 文件，配置一个 FieldType，使用 IKAnalyzer,下面相当于配置了一个bean<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;fieldType name=<span class="string">"text_ik"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"solr.TextField"</span>&gt;</span><br><span class="line">     &lt;analyzer <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.wltea.analyzer.lucene.IKAnalyzer"</span>/&gt;</span><br><span class="line">&lt;/fieldType&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="五-配置域"><a href="#五-配置域" class="headerlink" title="五. 配置域"></a>五. 配置域</h3><ul>
<li>域相当于数据库的表字段，用户存放数据，因此用户根据业务需要去定义相关的Field（域），一般来说，每一种对应着一种数据，用户对同一种数据进行相同的操作。<br>域的常用属性：<br>| 属性     |   含义 |<br>| :——– |——–:|<br>|name| 指定域的名称|<br>|type|指定域的类型|<br>|indexed|是否索引|<br>|stored|是否存储|<br>|required|是否必须|<br>|multiValued|是否多值|</li>
</ul>
<ul>
<li>修改solrhome的schema.xml 文件  设置业务系统 Field<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;field name=<span class="string">"item_goodsid"</span> type=<span class="string">"long"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;field name=<span class="string">"item_title"</span> type=<span class="string">"text_ik"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;field name=<span class="string">"item_price"</span> type=<span class="string">"double"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;field name=<span class="string">"item_image"</span> type=<span class="string">"string"</span> indexed=<span class="string">"false"</span> stored=<span class="string">"true"</span> /&gt;</span><br><span class="line">&lt;field name=<span class="string">"item_category"</span> type=<span class="string">"string"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"true"</span> /&gt;</span><br><span class="line">&lt;field name=<span class="string">"item_seller"</span> type=<span class="string">"text_ik"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"true"</span> /&gt;</span><br><span class="line">&lt;field name=<span class="string">"item_brand"</span> type=<span class="string">"string"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"true"</span> /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="六-复制域"><a href="#六-复制域" class="headerlink" title="六. 复制域"></a>六. 复制域</h3><ul>
<li>复制域的作用在于将某一个Field中的数据复制到另一个域中</li>
<li>他是不需要存储的,逻辑组合起来基它域信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;field name=<span class="string">"item_keywords"</span> type=<span class="string">"text_ik"</span> indexed=<span class="string">"true"</span> stored=<span class="string">"false"</span> multiValued=<span class="string">"true"</span>/&gt;</span><br><span class="line">&lt;copyField source=<span class="string">"item_title"</span> dest=<span class="string">"item_keywords"</span>/&gt;</span><br><span class="line">&lt;copyField source=<span class="string">"item_category"</span> dest=<span class="string">"item_keywords"</span>/&gt;</span><br><span class="line">&lt;copyField source=<span class="string">"item_seller"</span> dest=<span class="string">"item_keywords"</span>/&gt;</span><br><span class="line">&lt;copyField source=<span class="string">"item_brand"</span> dest=<span class="string">"item_keywords"</span>/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="七-动态域"><a href="#七-动态域" class="headerlink" title="七. 动态域"></a>七. 动态域</h3><ul>
<li>当我们需要动态扩充字段时，我们需要使用动态域。比如规格的值是不确定的，所以我们需要使用动态域来实现。需要实现的效果如下：使用一个map来实现.<br><img src="http://p6hod2vhp.bkt.clouddn.com/201810302142_233.png" alt=""></li>
<li><code>&lt;dynamicField name=&quot;item_spec_*&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;true&quot; /&gt;</code></li>
</ul>
<h3 id="八-Spring-Data-Solr简介"><a href="#八-Spring-Data-Solr简介" class="headerlink" title="八. Spring Data Solr简介"></a>八. Spring Data Solr简介</h3><p> Solr就是为了方便Solr的开发所研制的一个框架，其底层是对SolrJ（官方API）的封装。      </p>
<ol>
<li>创建maven工程SpringDataSolrDemo，pom.xml中引入依赖<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-data-solr&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.5.5.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="2-在src-main-resources下创建-applicationContext-solr-xml"><a href="#2-在src-main-resources下创建-applicationContext-solr-xml" class="headerlink" title="2. 在src/main/resources下创建  applicationContext-solr.xml"></a>2. 在src/main/resources下创建  applicationContext-solr.xml</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- solr服务器地址 --&gt;</span><br><span class="line">&lt;solr:solr-server id=<span class="string">"solrServer"</span> url=<span class="string">"http://127.0.0.1:8080/solr"</span> /&gt;</span><br><span class="line">&lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&gt;</span><br><span class="line">&lt;bean id=<span class="string">"solrTemplate"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.data.solr.core.SolrTemplate"</span>&gt;</span><br><span class="line">	&lt;constructor-arg ref=<span class="string">"solrServer"</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="八-Field-注解"><a href="#八-Field-注解" class="headerlink" title="八. @Field 注解"></a>八. @Field 注解</h3><p>TbItem实体类,属性使用@Field注解标识。如果属性与配置文件定义的域名称不一致，需要在注解中指定域名称。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Field</span>(<span class="string">"item_price"</span>)</span><br><span class="line"><span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="meta">@Field</span>(<span class="string">"item_image"</span>)</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="meta">@Field</span>(<span class="string">"item_goodsid"</span>)</span><br><span class="line">    <span class="keyword">private</span> Long goodsId;</span><br></pre></td></tr></table></figure></p>
<h3 id="九-增加（修改）"><a href="#九-增加（修改）" class="headerlink" title="九. 增加（修改）"></a>九. 增加（修改）</h3><ul>
<li>修改是先删除再增加<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations=<span class="string">"classpath:applicationContext-solr.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTemplate</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SolrTemplate solrTemplate;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">		TbItem item=<span class="keyword">new</span> TbItem();</span><br><span class="line">		item.setId(<span class="number">1L</span>);</span><br><span class="line">		item.setBrand(<span class="string">"华为"</span>);</span><br><span class="line">		item.setCategory(<span class="string">"手机"</span>);</span><br><span class="line">		item.setGoodsId(<span class="number">1L</span>);</span><br><span class="line">		item.setSeller(<span class="string">"华为2号专卖店"</span>);</span><br><span class="line">		item.setTitle(<span class="string">"华为Mate9"</span>);</span><br><span class="line">		item.setPrice(<span class="keyword">new</span> BigDecimal(<span class="number">2000</span>));		</span><br><span class="line">		solrTemplate.saveBean(item);</span><br><span class="line">		solrTemplate.commit();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="十-按主键查询"><a href="#十-按主键查询" class="headerlink" title="十. 按主键查询"></a>十. 按主键查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">	TbItem item = solrTemplate.getById(<span class="number">1</span>, TbItem.class);</span><br><span class="line">	System.out.println(item.getTitle());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十一-按主键删除"><a href="#十一-按主键删除" class="headerlink" title="十一. 按主键删除"></a>十一. 按主键删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">	solrTemplate.deleteById(<span class="string">"1"</span>);</span><br><span class="line">	solrTemplate.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十二-分页查询"><a href="#十二-分页查询" class="headerlink" title="十二. 分页查询"></a>十二. 分页查询</h3><ul>
<li>批量添加使用如下方法<br><code>solrTemplate.saveBeans(list);</code></li>
<li>编写分页查询测试代码：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Query query=<span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>);</span><br><span class="line">		query.setOffset(<span class="number">20</span>);<span class="comment">//开始索引（默认0）</span></span><br><span class="line">		query.setRows(<span class="number">20</span>);<span class="comment">//每页记录数(默认10)</span></span><br><span class="line">		ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query, TbItem.class);</span><br><span class="line">		System.out.println(<span class="string">"总记录数："</span>+page.getTotalElements());</span><br><span class="line">		List&lt;TbItem&gt; list = page.getContent();</span><br><span class="line">		showList(list);</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">//显示记录数据</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showList</span><span class="params">(List&lt;TbItem&gt; list)</span></span>&#123;		</span><br><span class="line">		<span class="keyword">for</span>(TbItem item:list)&#123;</span><br><span class="line">			System.out.println(item.getTitle() +item.getPrice());</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="十三-条件查询"><a href="#十三-条件查询" class="headerlink" title="十三. 条件查询"></a>十三. 条件查询</h3><ul>
<li>Criteria 用于对条件的封装：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageQueryMutil</span><span class="params">()</span></span>&#123;	</span><br><span class="line">		Query query=<span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>);</span><br><span class="line">		Criteria criteria=<span class="keyword">new</span> Criteria(<span class="string">"item_title"</span>).contains(<span class="string">"2"</span>);</span><br><span class="line">		criteria=criteria.and(<span class="string">"item_title"</span>).contains(<span class="string">"5"</span>);		</span><br><span class="line">		query.addCriteria(criteria);</span><br><span class="line">		<span class="comment">//query.setOffset(20);//开始索引（默认0）</span></span><br><span class="line">		<span class="comment">//query.setRows(20);//每页记录数(默认10)</span></span><br><span class="line">		ScoredPage&lt;TbItem&gt; page = solrTemplate.queryForPage(query, TbItem.class);</span><br><span class="line">		System.out.println(<span class="string">"总记录数："</span>+page.getTotalElements());</span><br><span class="line">		List&lt;TbItem&gt; list = page.getContent();</span><br><span class="line">		showList(list);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="十四-删除全部数据"><a href="#十四-删除全部数据" class="headerlink" title="十四. 删除全部数据"></a>十四. 删除全部数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">	Query query=<span class="keyword">new</span> SimpleQuery(<span class="string">"*:*"</span>);</span><br><span class="line">	solrTemplate.delete(query);</span><br><span class="line">	solrTemplate.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="十五-项目中运用"><a href="#十五-项目中运用" class="headerlink" title="十五.项目中运用"></a>十五.项目中运用</h3><h6 id="1-两种导入方法-第一种使用dataimpor-第二种使用工具类进行导入"><a href="#1-两种导入方法-第一种使用dataimpor-第二种使用工具类进行导入" class="headerlink" title="1. 两种导入方法,第一种使用dataimpor,第二种使用工具类进行导入"></a>1. 两种导入方法,第一种使用dataimpor,第二种使用工具类进行导入</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SolrUtil</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TbItemMapper itemMapper;</span><br><span class="line">	<span class="comment">//导入商品数据</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importItemData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		TbItemExample example=<span class="keyword">new</span> TbItemExample();</span><br><span class="line">		Criteria criteria = example.createCriteria();</span><br><span class="line">		criteria.andStatusEqualTo(<span class="string">"1"</span>);<span class="comment">//已审核</span></span><br><span class="line">		List&lt;TbItem&gt; itemList = itemMapper.selectByExample(example);</span><br><span class="line">		System.out.println(<span class="string">"===商品列表==="</span>);</span><br><span class="line">		<span class="keyword">for</span>(TbItem item:itemList)&#123;</span><br><span class="line">			System.out.println(item.getTitle());			</span><br><span class="line">		&#125;		</span><br><span class="line">		System.out.println(<span class="string">"===结束==="</span>);			</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext context=<span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath*:spring/applicationContext*.xml"</span>);</span><br><span class="line">		SolrUtil solrUtil=  (SolrUtil) context.getBean(<span class="string">"solrUtil"</span>);</span><br><span class="line">		solrUtil.importItemData();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-数据导入Solr索引库"><a href="#2-数据导入Solr索引库" class="headerlink" title="2. 数据导入Solr索引库"></a>2. 数据导入Solr索引库</h6><ol>
<li>实体类<br>（1）将demo工程中添加了@Field注解的实体类拷贝到pinyougou-pojo中<br>（2）在pojo中引入spring-data-solr依赖<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-data-solr&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;1.5.5.RELEASE&lt;/version&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="3-添加Solr配置文件"><a href="#3-添加Solr配置文件" class="headerlink" title="3. 添加Solr配置文件"></a>3. 添加Solr配置文件</h5><ul>
<li>添加applicationContext-solr.xml到spring目录<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- solr服务器地址 --&gt;</span><br><span class="line">&lt;solr:solr-server id=<span class="string">"solrServer"</span> url=<span class="string">"http://127.0.0.1:8080/solr"</span> /&gt;</span><br><span class="line">&lt;!-- solr模板，使用solr模板可对索引库进行CRUD的操作 --&gt;</span><br><span class="line">&lt;bean id=<span class="string">"solrTemplate"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.data.solr.core.SolrTemplate"</span>&gt;</span><br><span class="line">	&lt;constructor-arg ref=<span class="string">"solrServer"</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4-调用模板类导入solr"><a href="#4-调用模板类导入solr" class="headerlink" title="4. 调用模板类导入solr"></a>4. 调用模板类导入solr</h5><h5 id="5-规格导入动态域"><a href="#5-规格导入动态域" class="headerlink" title="5. 规格导入动态域"></a>5. 规格导入动态域</h5><ol>
<li>@Dynamic注解,修改TbItem.java ，添加动态域属性<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Dynamic</span></span><br><span class="line">    <span class="meta">@Field</span>(<span class="string">"item_spec_*"</span>)</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; specMap;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getSpecMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> specMap;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpecMap</span><span class="params">(Map&lt;String, String&gt; specMap)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.specMap = specMap;</span><br><span class="line">	&#125;</span><br><span class="line">``` </span><br><span class="line">##### 6. 修改导入工具</span><br><span class="line">- SolrUtil.java,引入fastJSON依赖</span><br><span class="line">```java</span><br><span class="line"><span class="comment">//导入商品数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">importItemData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		TbItemExample example=<span class="keyword">new</span> TbItemExample();</span><br><span class="line">		Criteria criteria = example.createCriteria();</span><br><span class="line">		criteria.andStatusEqualTo(<span class="string">"1"</span>);<span class="comment">//已审核</span></span><br><span class="line">		List&lt;TbItem&gt; itemList = itemMapper.selectByExample(example);</span><br><span class="line">		System.out.println(<span class="string">"===商品列表==="</span>);</span><br><span class="line">		<span class="keyword">for</span>(TbItem item:itemList)&#123;</span><br><span class="line">			Map specMap= JSON.parseObject(item.getSpec());<span class="comment">//将spec字段中的json字符串转换为map</span></span><br><span class="line">			item.setSpecMap(specMap);<span class="comment">//给带注解的字段赋值			</span></span><br><span class="line">			System.out.println(item.getTitle());			</span><br><span class="line">		&#125;</span><br><span class="line">		solrTemplate.saveBeans(itemList);</span><br><span class="line">		solrTemplate.commit();</span><br><span class="line">		System.out.println(<span class="string">"===结束==="</span>);	</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</div><iframe src="/donate/?AliPayQR=/img/AliPayQR.png&amp;WeChatQR=/img/WeChatQR.png&amp;GitHub=null&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden; overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe><div class="tags"><a href="/tags/solr/">solr</a></div><div class="post-nav"><a class="pre" href="/2015/11/01/观察者模式/">观察者模式</a><a class="next" href="/2015/10/28/web xml之四(dao 二)/">ssm整合之三(dao配置2)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVAWEB/">JAVAWEB</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/框架/">框架</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/解决/">解决</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/struts/" style="font-size: 15px;">struts</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/spring-mvc/" style="font-size: 15px;">spring mvc</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/springAOP/" style="font-size: 15px;">springAOP</a> <a href="/tags/svn/" style="font-size: 15px;">svn</a> <a href="/tags/idea/" style="font-size: 15px;">idea</a> <a href="/tags/观察者模式/" style="font-size: 15px;">观察者模式</a> <a href="/tags/service-xml-trans-xml/" style="font-size: 15px;">service.xml trans.xml</a> <a href="/tags/dao-xml/" style="font-size: 15px;">dao.xml</a> <a href="/tags/orcal/" style="font-size: 15px;">orcal</a> <a href="/tags/solr/" style="font-size: 15px;">solr</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/web-xml/" style="font-size: 15px;">web.xml</a> <a href="/tags/mvc-xml/" style="font-size: 15px;">mvc.xml</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/30/idea快捷键/">idea快捷键</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/18/git使用/">git使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/18/linux软件的安装/">linux软件的安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/18/mysql 5.7.22解压版安装教程,亲测/">mysql 5.7.22解压版安装教程,亲测</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/09/spring第一天/">spring第一天</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/01/springAOP/">spring AOP</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/01/观察者模式/">观察者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/30/solr/">Solr</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/28/web xml之四(dao 二)/">ssm整合之三(dao配置2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/27/web xml之四(dao)/">ssm整合之三(dao配置)</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/your-user-name" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="http://douban.com/people/your-user-name" title="豆瓣" target="_blank">豆瓣</a><ul></ul><a href="http://www.zhihu.com/people/your-user-name" title="知乎" target="_blank">知乎</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018  阙继芳</div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>